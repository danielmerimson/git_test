# Task Calendar Development Makefile

.PHONY: help install dev dev-full backend frontend test clean setup

# Default target
help:
	@echo "ğŸš€ Task Calendar Development Commands"
	@echo "===================================="
	@echo "make install     - Install all dependencies"
	@echo "make dev-full    - Run start-dev.sh script (full development)"
	@echo "make dev         - Start both frontend and backend separately"
	@echo "make backend     - Start backend only"
	@echo "make frontend    - Start frontend only"
	@echo "make test        - Run all tests"
	@echo "make test-backend - Run backend tests only"
	@echo "make clean       - Clean all dependencies and build files"
	@echo "make setup       - Initial project setup"
	@echo "make health      - Check if services are running"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing frontend dependencies..."
	npm install
	@echo "ğŸ“¦ Installing backend dependencies..."
	cd backend && npm install
	@echo "âœ… All dependencies installed!"

# Run the start-dev.sh script
dev-full:
	@echo "ğŸš€ Starting full development environment..."
	chmod +x start-dev.sh
	./start-dev.sh

# Start development servers separately
dev: install
	@echo "ğŸ”§ Starting backend server..."
	cd backend && npm run dev &
	@echo "â³ Waiting for backend to start..."
	sleep 3
	@echo "ğŸ¨ Starting frontend development server..."
	npm start

# Start backend only
backend:
	@echo "ğŸ”§ Starting backend server..."
	cd backend && npm run dev

# Start frontend only
frontend:
	@echo "ğŸ¨ Starting frontend development server..."
	npm start

# Run tests
test:
	@echo "ğŸ§ª Running backend tests..."
	cd backend && npm test
	@echo "âœ… All tests passed!"

test-backend:
	@echo "ğŸ§ª Running backend tests..."
	cd backend && npm test

# Clean everything
clean:
	@echo "ğŸ§¹ Cleaning dependencies and build files..."
	rm -rf node_modules
	rm -rf backend/node_modules
	rm -rf dist
	rm -f backend/tasks.db
	@echo "âœ… Cleanup complete!"

# Initial setup
setup: clean install
	@echo "ğŸ”§ Setting up development environment..."
	chmod +x start-dev.sh
	@echo "âœ… Setup complete! Run 'make dev-full' to start development."

# Health check
health:
	@echo "ğŸ¥ Checking service health..."
	@curl -f http://localhost:3002/api/health 2>/dev/null && echo "âœ… Backend is running" || echo "âŒ Backend is not running"
	@curl -f http://localhost:8080 2>/dev/null && echo "âœ… Frontend is running" || echo "âŒ Frontend is not running"

# Build for production
build: install
	@echo "ğŸ—ï¸ Building for production..."
	npm run build
	@echo "âœ… Build complete!"

# Development with logs
dev-logs: install
	@echo "ğŸš€ Starting development with logs..."
	cd backend && npm run dev > ../backend.log 2>&1 &
	npm start > frontend.log 2>&1 &
	@echo "ğŸ“ Logs are being written to backend.log and frontend.log"
	@echo "Press Ctrl+C to stop all services"
